<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .emergency-card { border-left: 4px solid #dc3545; }
        .volunteer-card { border-left: 4px solid #198754; }
        .map-container { height: 400px; background: #f8f9fa; border-radius: 8px; }
        .login-container { max-width: 400px; margin: 100px auto; }
        .hidden { display: none; }
        .navbar-brand { font-weight: bold; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-house-medical"></i> Emergency Response System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text me-3" id="userInfo"></span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- Login Section -->
    <div id="loginSection" class="container">
        <div class="login-container">
            <div class="card shadow">
                <div class="card-body">
                    <h3 class="card-title text-center mb-4">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </h3>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                    </form>
                    <div class="mt-3 text-center">
                        <small>Demo accounts: admin/admin123, volunteer/vol123</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appSection" class="hidden container mt-4">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="d-grid gap-2 mb-3">
                    <button class="btn btn-primary" onclick="showSection('dashboard')">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </button>
                    <button class="btn btn-outline-primary" onclick="showSection('emergencies')">
                        <i class="fas fa-exclamation-triangle"></i> Emergencies
                    </button>
                    <button class="btn btn-outline-primary" onclick="showSection('volunteers')">
                        <i class="fas fa-hands-helping"></i> Volunteers
                    </button>
                    <button class="btn btn-outline-primary" onclick="showSection('help')">
                        <i class="fas fa-question-circle"></i> How to Help
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- Dashboard -->
                <div id="dashboardSection" class="section">
                    <h3><i class="fas fa-tachometer-alt"></i> Dashboard</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-white bg-danger mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Active Emergencies</h5>
                                    <h2 id="activeEmergenciesCount" class="card-text">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Available Volunteers</h5>
                                    <h2 id="availableVolunteersCount" class="card-text">0</h2>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-info mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">People Affected</h5>
                                    <h2 id="peopleAffectedCount" class="card-text">0</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="map-container mt-4 p-3">
                        <h5>Live Emergency Map</h5>
                        <p class="text-muted">Map integration would go here (Google Maps/OpenStreetMap)</p>
                        <div class="text-center">
                            <i class="fas fa-map-marked-alt" style="font-size: 48px; color: #6c757d;"></i>
                        </div>
                    </div>
                </div>

                <!-- Emergencies -->
                <div id="emergenciesSection" class="section hidden">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-exclamation-triangle"></i> Emergency Reports</h3>
                        <button class="btn btn-primary" onclick="showNewEmergencyForm()">
                            <i class="fas fa-plus"></i> Report Emergency
                        </button>
                    </div>
                    
                    <!-- New Emergency Form -->
                    <div id="newEmergencyForm" class="card hidden mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Report New Emergency</h5>
                            <form id="emergencyForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Emergency Type</label>
                                            <select class="form-select" id="emergencyType" required>
                                                <option value="">Select type...</option>
                                                <option value="Flood">Flood</option>
                                                <option value="Earthquake">Earthquake</option>
                                                <option value="Fire">Fire</option>
                                                <option value="Medical">Medical Emergency</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Location</label>
                                            <input type="text" class="form-control" id="emergencyLocation" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">People Affected</label>
                                            <input type="number" class="form-control" id="peopleAffected" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Needs</label>
                                            <div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="Food" id="needFood">
                                                    <label class="form-check-label" for="needFood">Food</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="Shelter" id="needShelter">
                                                    <label class="form-check-label" for="needShelter">Shelter</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="Medical" id="needMedical">
                                                    <label class="form-check-label" for="needMedical">Medical</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="emergencyDescription" rows="3" required></textarea>
                                </div>
                                <button type="submit" class="btn btn-success">Submit Report</button>
                                <button type="button" class="btn btn-secondary" onclick="hideNewEmergencyForm()">Cancel</button>
                            </form>
                        </div>
                    </div>

                    <!-- Emergencies List -->
                    <div id="emergenciesList"></div>
                </div>

                <!-- Volunteers -->
                <div id="volunteersSection" class="section hidden">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-hands-helping"></i> Volunteers</h3>
                        <button class="btn btn-primary" onclick="showVolunteerForm()">
                            <i class="fas fa-user-plus"></i> Register as Volunteer
                        </button>
                    </div>

                    <!-- Volunteer Registration Form -->
                    <div id="volunteerForm" class="card hidden mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Volunteer Registration</h5>
                            <form id="volunteerRegistrationForm">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Full Name</label>
                                            <input type="text" class="form-control" id="volunteerName" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Location</label>
                                            <input type="text" class="form-control" id="volunteerLocation" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Contact Info</label>
                                            <input type="text" class="form-control" id="volunteerContact" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Skills</label>
                                            <div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="First Aid" id="skillFirstAid">
                                                    <label class="form-check-label" for="skillFirstAid">First Aid</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="Rescue" id="skillRescue">
                                                    <label class="form-check-label" for="skillRescue">Rescue</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox" value="Medical" id="skillMedical">
                                                    <label class="form-check-label" for="skillMedical">Medical</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-success">Register</button>
                                <button type="button" class="btn btn-secondary" onclick="hideVolunteerForm()">Cancel</button>
                            </form>
                        </div>
                    </div>

                    <!-- Volunteers List -->
                    <div id="volunteersList"></div>
                </div>

                <!-- How to Help -->
                <div id="helpSection" class="section hidden">
                    <h3><i class="fas fa-question-circle"></i> How to Help</h3>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-body text-center">
                                    <i class="fas fa-money-bill-wave fa-2x text-success mb-3"></i>
                                    <h5>Financial Donations</h5>
                                    <p class="text-muted">Support emergency response efforts with financial contributions</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-body text-center">
                                    <i class="fas fa-home fa-2x text-primary mb-3"></i>
                                    <h5>Provide Shelter</h5>
                                    <p class="text-muted">Offer temporary housing for affected individuals and families</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card mb-3">
                                <div class="card-body text-center">
                                    <i class="fas fa-truck fa-2x text-warning mb-3"></i>
                                    <h5>Emergency Vehicles</h5>
                                    <p class="text-muted">Assist with transportation and logistics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <h5>Emergency Contacts</h5>
                            <ul class="list-group">
                                <li class="list-group-item">
                                    <i class="fas fa-phone text-danger"></i>
                                    Emergency Services: 911
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-hospital text-info"></i>
                                    Medical Emergency: 112
                                </li>
                                <li class="list-group-item">
                                    <i class="fas fa-fire-extinguisher text-warning"></i>
                                    Fire Department: 911
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentUser = null;

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const response = await fetch('/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });

            const result = await response.json();
            if (result.success) {
                currentUser = result.user;
                document.getElementById('userInfo').textContent = `Welcome, ${currentUser.username}`;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('appSection').classList.remove('hidden');
                loadDashboard();
            } else {
                alert('Login failed: ' + result.message);
            }
        });

        function logout() {
            currentUser = null;
            document.getElementById('loginSection').classList.remove('hidden');
            document.getElementById('appSection').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionName + 'Section').classList.remove('hidden');
        }

        // Dashboard functions
        async function loadDashboard() {
            const emergencies = await fetch('/emergencies').then(r => r.json());
            const volunteers = await fetch('/volunteers').then(r => r.json());
            
            document.getElementById('activeEmergenciesCount').textContent = emergencies.length;
            document.getElementById('availableVolunteersCount').textContent = volunteers.length;
            document.getElementById('peopleAffectedCount').textContent = 
                emergencies.reduce((sum, e) => sum + e.people_affected, 0);
        }

        // Emergency functions
        function showNewEmergencyForm() {
            document.getElementById('newEmergencyForm').classList.remove('hidden');
        }

        function hideNewEmergencyForm() {
            document.getElementById('newEmergencyForm').classList.add('hidden');
            document.getElementById('emergencyForm').reset();
        }

        document.getElementById('emergencyForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const needs = [];
            if (document.getElementById('needFood').checked) needs.push('Food');
            if (document.getElementById('needShelter').checked) needs.push('Shelter');
            if (document.getElementById('needMedical').checked) needs.push('Medical');

            const emergencyData = {
                type: document.getElementById('emergencyType').value,
                location: document.getElementById('emergencyLocation').value,
                description: document.getElementById('emergencyDescription').value,
                people_affected: parseInt(document.getElementById('peopleAffected').value),
                needs: needs
            };

            const response = await fetch('/emergencies', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(emergencyData)
            });

            const result = await response.json();
            if (result.success) {
                alert('Emergency reported successfully!');
                hideNewEmergencyForm();
                loadEmergencies();
                loadDashboard();
            }
        });

        async function loadEmergencies() {
            const emergencies = await fetch('/emergencies').then(r => r.json());
            const container = document.getElementById('emergenciesList');
            
            container.innerHTML = emergencies.map(emergency => `
                <div class="card emergency-card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="card-title">
                                    <i class="fas fa-exclamation-triangle text-danger"></i>
                                    ${emergency.type} Emergency
                                </h5>
                                <p class="card-text">
                                    <i class="fas fa-map-marker-alt"></i> ${emergency.location}<br>
                                    <i class="fas fa-users"></i> ${emergency.people_affected} people affected<br>
                                    <i class="fas fa-list"></i> Needs: ${emergency.needs.join(', ')}
                                </p>
                                <p class="card-text">${emergency.description}</p>
                            </div>
                            <span class="badge bg-${emergency.status === 'active' ? 'danger' : 'secondary'}">
                                ${emergency.status}
                            </span>
                        </div>
                        <small class="text-muted">Reported: ${new Date(emergency.created_at).toLocaleString()}</small>
                    </div>
                </div>
            `).join('');
        }

        // Volunteer functions
        function showVolunteerForm() {
            document.getElementById('volunteerForm').classList.remove('hidden');
        }

        function hideVolunteerForm() {
            document.getElementById('volunteerForm').classList.add('hidden');
            document.getElementById('volunteerRegistrationForm').reset();
        }

        document.getElementById('volunteerRegistrationForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const skills = [];
            if (document.getElementById('skillFirstAid').checked) skills.push('First Aid');
            if (document.getElementById('skillRescue').checked) skills.push('Rescue');
            if (document.getElementById('skillMedical').checked) skills.push('Medical');

            const volunteerData = {
                name: document.getElementById('volunteerName').value,
                location: document.getElementById('volunteerLocation').value,
                contact: document.getElementById('volunteerContact').value,
                skills: skills
            };

            const response = await fetch('/volunteers', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(volunteerData)
            });

            const result = await response.json();
            if (result.success) {
                alert('Volunteer registered successfully!');
                hideVolunteerForm();
                loadVolunteers();
                loadDashboard();
            }
        });

        async function loadVolunteers() {
            const volunteers = await fetch('/volunteers').then(r => r.json());
            const container = document.getElementById('volunteersList');
            
            container.innerHTML = volunteers.map(volunteer => `
                <div class="card volunteer-card mb-3">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="card-title">
                                    <i class="fas fa-user-check text-success"></i>
                                    ${volunteer.name}
                                </h5>
                                <p class="card-text">
                                    <i class="fas fa-map-marker-alt"></i> ${volunteer.location}<br>
                                    <i class="fas fa-phone"></i> ${volunteer.contact}<br>
                                    <i class="fas fa-tools"></i> Skills: ${volunteer.skills.join(', ')}
                                </p>
                            </div>
                            <span class="badge bg-${volunteer.status === 'available' ? 'success' : 'secondary'}">
                                ${volunteer.status}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Initialize section loading
        showSection('dashboard');
    </script>
</body>
</html>